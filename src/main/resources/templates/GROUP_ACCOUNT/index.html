<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Group Account Allbookers </title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="vendors/feather/feather.css">
    <link rel="stylesheet" href="vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" href="vendors/css/vendor.bundle.base.css">

    <link rel="stylesheet" href="vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" type="text/css" href="js/select.dataTables.min.css">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="../../css/vertical-layout-light/style.css">
    <link rel="stylesheet" href="../../css/style.css">
    <!-- endinject -->
    <link rel="shortcut icon" href="images/favicon.png"/>
    <link href="https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css"
          rel="stylesheet">
    <link rel="stylesheet" href="vendors/datatables.net-bs4/dataTables.bootstrap4.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap4.min.css">
    <script src="../../js/sweetAlert.js"></script>
    <style>
        button.remove-property-btn {
            margin-left: auto;
            margin-right: 5%;
            font-size: 0.875rem;
            line-height: 1;
            font-weight: 500;
            border-radius: 15px;
            color: #fff;
            padding: 6px 10px;
            background-color: #FF4747;
            border-color: #FF4747;
        }
        button.remove-property-btn:hover {
            font-weight: 700;
            background-color: #d73e3e;
            border-color: #FF4747;
        }
        .card-body.d-flex:hover {
            background-color: #ebf5ff!important;
        }
        .dataTables_filter input {
            border: 1px solid #ddd;
            padding: 10px 10px 10px 20px; /* Adjust padding for icon space */
            border-radius: 5px;
            width: 100%;
            max-width: 300px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 14px;
            color: #333;
        }

        .dataTables_filter svg {
            position: absolute;
            left: 20px;
            width: 16px;
            height: 16px;
            fill: #aaa; /* Adjust color as needed */
        }

        /* Change input focus outline */
        .dataTables_filter input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
        }

        canvas {
            border-radius: 20px;
            --bg-opacity: 1;
            border-width: 1px;
            --border-opacity: 1;
            border-color: #e2e8f0;
            border-color: rgba(226, 232, 240, var(--border-opacity));
        }
        .row {
            display: flex;
            flex-wrap: nowrap;
            margin-right: -15px;
            margin-left: -15px;
        }
        .nav-list{
            list-style-type: none;
            padding-right: 10px;
            padding-left: 10px;
        }
        .nav-dashboard{
            text-decoration: none;
            color: black;
            font-size: 15px;
        }
        .content-wrapper {
            padding: 3.175rem 1.375rem 1rem 1.375rem;
            width: 100%;
        }
        .grid-margin {
            margin-bottom: 0.5rem;
        }

        .title1 {
            margin: 0px;
            font-family: "Open Sans", Helvetica, Arial, sans-serif;
            font-size: 0.875rem;
            line-height: 1.5;
            opacity: 1;
            text-transform: uppercase;
            vertical-align: unset;
            text-decoration: none;
            color: rgb(103, 116, 142);
            font-weight: 600;
        }

        img.t-2w {
            width: 38px;
        }
        .\33 -1-t.d-flex {
            flex-direction: column;
            margin-left: 21px;
        }
        .title2 {
            font-size: 1.25rem;
            line-height: 1.375;
            font-family: "Open Sans", Helvetica, Arial, sans-serif;
            opacity: 1;
            text-transform: none;
            vertical-align: unset;
            text-decoration: none;
            color: rgb(52, 71, 103);
            font-weight: 700;
        }
        .toptitle {
            display: flex;
            align-items: center;
            margin-left: 7px;
            color: #1A1A1A;
            line-height: 20px;
            position: relative;
            padding-top: 60px;
            width: 100%;
        }
        .add-property-link {
            margin-left: auto;
            margin-right: 5%;
            font-size: 0.875rem;
            line-height: 1;
            font-weight: 500;
            border-radius: 15px;
            color: #fff;
            background-color: #2c547c;
            border-color: #214162;
            padding: 10px 15px;
        }
        .add-property-link:hover {
            font-weight: 600;
            background-color: #214162;
            color: #fff;
        }
    </style>
</head>

<body>
<div class="container-scroller">
    <div th:replace="/GROUP_ACCOUNT/Layouts/navbar"></div>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
        <!-- partial:partials/_settings-panel.html -->
        <div th:replace="/GROUP_ACCOUNT/Layouts/sidebar"></div>
        <!-- partial -->
        <div class="main-panel">
            <div class="content-wrapper">
                <div class="row">
                    <div class="col-md-12 grid-margin">
                        <div class="row">
                            <div class="toptitle">
                                <h2> Group homepage </h2>
                                <a th:href="@{'/addNewPropertyfromGroupAccount'}" target="_blank" class="add-property-link">Add new property</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <ul style="display: flex;">
                    <li class="nav-list" style="border-bottom: 2px solid #fb8540; font-weight: 600;"><a th:href="@{/}" class="nav-dashboard">Operations</a></li>
                    <li class="nav-list" style="border-bottom: 2px solid #ebebeb; font-weight: 500;"><a th:href="@{/}" class="nav-dashboard">Performance</a></li>
                    <li class="nav-list" style="border-bottom: 2px solid #ebebeb; font-weight: 500;"><a th:href="@{/}" class="nav-dashboard">Settings</a></li>
                </ul>
            </div>
            <div id="operations" style="padding: 20px;">
                <h3 style="color: #1A1A1A;">Happening today</h3>
                <div class="row">
                    <div class="col-md-6 stretch-card transparent">
                        <div class="card card-dark-blue test-card">
                            <a th:href="@{'/reviews'}" aria-expanded="false"
                               aria-controls="error">
                                <div class="card-body d-flex">
                                    <div class="icon-1-2-1">
                                        <img src="images/review.png" class="t-2w"/></div>
                                    <div class="3-1-t d-flex">
                                        <div class="title1">Reviews</div>
                                        <div class="title2" th:text="${allReviewsSize}"></div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="num-1-12 pt-4 pb-1 arrivals-buttons">
                    <div>List of properties</div>
                    <div class="buttons-propdash">
                        <button type="button" onclick="ExportToExcelArrivals('xlsx')" class="btn btn-outline-primary btn-icon-text m-2 p-2 centered-button">
                            <i class="ti-file btn-icon-prepend"></i>
                            [[#{client.Exporttabletoexcel}]]
                        </button>

                        <button type="button" onclick="printArrivalsDiv()" class="btn btn-outline-dark btn-icon-text m-2 p-2 centered-button">
                            [[#{client.Print}]]
                            <i class="ti-printer btn-icon-append"></i>
                        </button>

                        <button type="button" onclick="ExportArrivals()" id="btnExportArrivals" value="Export"
                                class="btn btn-light btn-icon-text m-2 p-2 centered-button">
                            [[#{client.Download}]] PDF
                            <i class="ti-download btn-icon-append"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <div class="row a-1 card-body">
                        <div class="table-responsive table-striped">
                            <table id="arrivals" class="table">
                                <thead>
                                    <tr style="background: #214162;padding: 10px;color: #ffffff;font-size: 14px;">
                                        <th>ID</th>
                                        <th>Property</th>
                                        <th>Status on Allbookers.com</th>
                                        <th>Arrivals in next 48 hours </th>
                                        <th>Departures in next 48 hours</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="table-row-1" th:each="p: ${properties}">
                                        <td th:text="${p.getId()}"></td>
                                        <td>
                                            <a th:href="@{'/propertydashboard?propertyId='+${p.getId()}}" style="color:black">
                                                <span th:text="${p.getName()}"></span>
                                                <br>
                                                <span style="color: #757575; font-size: 11px;" th:text="${p.getAddress().getStreet() + ', ' + p.getAddress().getCity().getFull_name() + ', ' + p.getAddress().getCity().getCounty().getCountry().getCountry_name()}"></span>
                                            </a>
                                        </td>
                                        <td th:text="${p.getHotel_status().getId()==1? ' ● Active' : ' ● Suspend'}" th:style="${p.getHotel_status().getId()==1?'color:darkgreen; text-align: center;':'color:darkred; text-align: center;'}"></td>
                                        <td th:text="${startedInLast48HoursSize}" style="text-align: center;"></td>
                                        <td th:text="${endedInLast48HoursSize}" style="text-align: center;"></td>
                                        <td>
                                            <button class="remove-property-btn" th:onclick="|removeProperty(${p.getId()})|">Disconnect from the group account</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div th:replace="/GROUP_ACCOUNT/Layouts/footer.html"></div>
        </div>
    </div>
</div>

<script src="../../vendors/js/vendor.bundle.base.js"></script>
<script src="../../js/off-canvas.js"></script>
<script src="../../js/hoverable-collapse.js"></script>
<script src="../../js/template.js"></script>
<script src="../../js/settings.js"></script>
<script src="../../js/todolist.js"></script>
<script src="js/dashboard.js"></script>
<script src="js/commonJs.js"></script>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.22/pdfmake.min.js" defer></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>

<script>
    function changeLanguageController(param) {

        var a = 'sq';
        if (param == null) {
            param = a;
        }

        var search = {"lang": a};
        $.ajax({
            type: "POST",
            url: "/changeLanguage",
            data: {
                lang: param
            },
            success: function (result) {
                window.location = '/'  ;
            },
            error: function (e) {
                window.location = '/error.' + param + '.html';
            }
        });
    }
</script>
<script>

    $(document).ready(function () {
        $('#arrivals').DataTable({
            "paging": true,
            "ordering": true,
            "info": false,
            "searching":true
        });
    });
</script>

<script>
    function ExportToExcelArrivals(type, fn, dl) {
        var elt = document.getElementById('arrivals');
        var wb = XLSX.utils.table_to_book(elt, {sheet: "sheet1"});
        return dl ?
            XLSX.write(wb, {bookType: type, bookSST: true, type: 'base64'}) :
            XLSX.writeFile(wb, fn || ('ArrivalsReservationStatements.' + (type || 'xlsx')));
    }
</script>
<script type="text/javascript">
    function ExportArrivals() {
        html2canvas(document.getElementById('arrivals'), {
            onrendered: function (canvas) {
                var data = canvas.toDataURL();
                var docDefinition = {
                    content: [{
                        image: data,
                        width: 500
                    }]
                };
                pdfMake.createPdf(docDefinition).download("ArrivalsTable.pdf");
            }
        });
    }
</script>

<!--<script th:inline="javascript">-->
<!--    /*<![CDATA[*/-->

<!--    function removeProperty(propertyId) {-->
<!--        swal({-->
<!--            title: "Are you sure you want to disconnect this property?",-->
<!--            text: "This action will remove the property from your account.",-->
<!--            icon: "warning",-->
<!--            buttons: true,-->
<!--            dangerMode: true,-->
<!--        })-->
<!--            .then((willRemove) => {-->
<!--                if (willRemove) {-->
<!--                    $.ajax({-->
<!--                        url: '/removePropertyFromMyPrimaryAccount',-->
<!--                        type: 'POST',-->
<!--                        data: {propertyId: propertyId},-->
<!--                        success: function (response) {-->
<!--                            swal("Success!", response, "success").then(function () {-->
<!--                                // Heq rreshtin nga tabela-->
<!--                                $("button[th\\:onclick='removeProperty(" + propertyId + ")']").closest("tr").remove();-->

<!--                                // Ri-ngarko faqen pas suksesit-->
<!--                                location.reload();  // Kjo do të rimbushë faqen-->
<!--                            });-->
<!--                        },-->
<!--                        error: function (xhr) {-->
<!--                            let errorMessage = xhr.responseText || "An unexpected error occurred.";-->
<!--                            swal("Error!", errorMessage, "error");-->
<!--                        }-->
<!--                    });-->
<!--                } else {-->
<!--                    swal("Cancelled", "The property was not removed", "info");-->
<!--                }-->
<!--            });-->
<!--    }-->

<!--    /*]]>*/-->
<!--</script>-->

<script th:inline="javascript">
    /*<![CDATA[*/
    function removeProperty(propertyId) {
        swal({
            title: "Are you sure you want to disconnect this property?",
            text: "This action will remove the property from your account.",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
            .then((willRemove) => {
                if (willRemove) {
                    $.ajax({
                        url: '/removePropertyFromMyPrimaryAccount',
                        type: 'POST',
                        data: {propertyId: propertyId},
                        success: function (response) {
                            swal("Success!", response, "success").then(function () {
                                $("button[th\\:onclick='removeProperty(" + propertyId + ")']").closest("tr").remove();
                                location.reload();
                            });
                        },
                        error: function (xhr) {
                            let errorMessage = xhr.responseText || "An unexpected error occurred.";

                            if (errorMessage.includes("You need to create a basic user for this property to proceed.")) {
                                swal({
                                    title: "Error!",
                                    text: errorMessage,
                                    icon: "error",
                                    buttons: {
                                        cancel: "Close",
                                        createUser: {
                                            text: "Create User",
                                            value: "createUser",
                                        },
                                    },
                                }).then((value) => {
                                    if (value === "createUser") {
                                        window.location.href = "/addnewuserr?propertyId=" + propertyId;
                                    }
                                });
                            } else {
                                swal("Error!", errorMessage, "error");
                            }
                        }
                    });
                } else {
                    swal("Cancelled", "The property was not removed", "info");
                }
            });
    }

    /*]]>*/
</script>

<script>
    function printArrivalsDiv() {
        var divToPrint = document.getElementById('arrivals');
        var htmlToPrint = '' +
            '<style type="text/css">' +
            'table th, table td {' +
            'border:1px solid #000;' +
            'padding:0.5em;' +
            '}' +
            '</style>';
        htmlToPrint += divToPrint.outerHTML;
        newWin = window.open("");
        newWin.document.write(htmlToPrint);
        newWin.print();
        newWin.close();
    }
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
<script src="vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
<script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap4.min.js"></script>

</body>
</html>

